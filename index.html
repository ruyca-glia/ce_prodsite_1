<!DOCTYPE html>
<html>
  <head>
    <script async src="https://api.glia.com/salemove_integration.js"></script>

    <script>
      console.log("[Glia Debug] 1. Script parsed, setting up Glia waiter...");

      window.smReady = function() {
        console.log("[Glia Debug] 2. smReady() triggered. Requesting Glia API...");
        
        sm.getApi({ version: 'v1' }).then(function(salemove) {
          console.log("[Glia Debug] 3. sm.getApi() resolved. Glia API is available.");

          // TEMPORARY FIX: Set this to false so Glia renders its default Video UI!
          salemove.config.isCustomTheme = false; 
          
          salemove.config.reactiveTabVisuals = {
            backColor: "#0000FF",
            frontColor: "#FF0000",
            fontSize: 14,
            format: "text",
            iconType: "text",
            placement: "right",
            size: 80,
            text: "Click Me!",
            verticalOffset: 100,
            visibleOperatorCount: 1
          };
          console.log("[Glia Debug] 4. SDK config applied. Custom Theme is OFF for testing.");

          // Keeping our manual button just in case
          function setupVideoButton() {
            const videoBtn = document.getElementById('start-video-btn');
            if (videoBtn) {
              videoBtn.addEventListener('click', function() {
                console.log("[Glia Debug] Manual video button clicked...");
                salemove.requestEngagement('video')
                  .catch(function(error) {
                    console.error('[Glia Debug] ERROR:', error);
                  });
              });
            }
          }

          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', setupVideoButton);
          } else {
            setupVideoButton();
          }

        }).catch(function(err) {
          console.error("[Glia Debug] ERROR: Failed to get Glia API:", err);
        });
      };

      function checkGliaReady() {
        if (window.sm && typeof window.sm.getApi === 'function') {
           window.smReady();
        } else {
           setTimeout(checkGliaReady, 100);
        }
      }

      checkGliaReady();
    </script>

    <title>CE Testing Site</title>
    <link rel="icon" type="image/x-icon" href="images/favicon.ico">
    <style>
      h1 { color:#7C19DD; font-family:roboto; text-align:center; }
      img { width:50%; display: block; margin: 0 auto; }
      .nav-container { text-align: center; margin-top: 20px; }
      .btn {
        padding: 10px 20px;
        background-color: #7C19DD;
        color: white;
        text-decoration: none;
        border-radius: 5px;
        font-family: roboto, sans-serif;
        border: none;
        cursor: pointer;
        font-size: 16px;
        display: inline-block;
        margin: 5px;
      }
      .btn-orange { background-color: #FF5722; }
      .btn:hover { opacity: 0.9; }
    </style>
    <link rel="stylesheet" href="./static/css/styles.css">
    <script type="text/javascript" src="./static/js/client-app.js" defer></script>
  </head>

  <body>
    <center>
      <img src="images/Full LOGO_black.png" alt="CE logo" style="width:750px">
    </center>

    <h1 id="title" class="title">Welcome to our PROD site!</h1>

    <div class="nav-container">
      <button id="start-video-btn" class="btn">Force Video API Call</button>
      
      <div data-sm-show-media-selection-on="click" class="btn btn-orange">
        Open Glia Media Selector
      </div>
    </div>

    <div class="nav-container">
      <a href="/static/other_page.html" class="btn">Go to Cat Facts</a>
    </div>

    <div class="nav-container">
      <a href="./static/desafilacion.html" id="redirect-link" class="btn">Go to desafilacion</a>
    </div>

  </body>
</html>